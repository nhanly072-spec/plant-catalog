<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Báº£ng tra cá»©u chá»‰ sá»‘ cÃ¢y trá»“ng ğŸŒ¿</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background-color: #eaf7e5;
      color: #333;
    }
    .container {
      max-width: 850px;
      margin: 40px auto;
      background: #fff;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 0 12px #b7d3b1;
    }
    h1 {
      text-align: center;
      color: #2e7d32;
    }
    .search-bar {
      text-align: center;
      margin-bottom: 20px;
    }
    select, input {
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin: 0 4px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #c8e6c9;
      padding: 10px;
      text-align: left;
    }
    th {
      background: #a5d6a7;
    }
    .btn {
      padding: 10px 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: 0.25s;
    }
    .btn-success {
      background: #4caf50;
      color: white;
    }
    .btn-success:hover {
      background: #43a047;
    }
    #note {
      text-align: center;
      font-style: italic;
      color: #555;
    }
    .plant-header {
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸŒ¾ Báº¢NG TRA Cá»¨U CHá»ˆ Sá» CÃ‚Y TRá»’NG</h1>

    <div class="search-bar">
      <label>ğŸ” TÃ¬m cÃ¢y:</label>
      <input type="text" id="searchInput" placeholder="GÃµ tÃªn cÃ¢y (vÃ­ dá»¥: á»›t, lan, xÃ  lÃ¡ch)">
      <span>Hoáº·c chá»n cÃ¢y:</span>
      <select id="plantSelect"></select>
    </div>

    <div class="plant-info" id="plantInfo">
      <div class="plant-header">
        <div id="plantIcon" style="font-size:48px;">ğŸŒ±</div>
        <h2 id="plantName">TÃªn cÃ¢y</h2>
        <p id="plantLatin"><em>(TÃªn khoa há»c)</em></p>
      </div>

      <table>
        <thead>
          <tr>
            <th>ThÃ´ng sá»‘</th>
            <th>GiÃ¡ trá»‹ phÃ¹ há»£p</th>
          </tr>
        </thead>
        <tbody id="paramTable"></tbody>
      </table>

      <p id="note"><em>Chá»n cÃ¢y Ä‘á»ƒ xem thÃ´ng sá»‘ khuyáº¿n nghá»‹.</em></p>

      <div style="text-align:center; margin-top:20px;">
        <button id="applyBtn" class="btn btn-success">ğŸŒ¿ Ãp dá»¥ng thÃ´ng sá»‘</button>
      </div>
    </div>
  </div>

  <script>
    // ğŸŒ± Danh sÃ¡ch cÃ¢y trá»“ng
    const plants = [
      {
        name: "LÃºa",
        latin: "Oryza sativa",
        icon: "ğŸŒ¾",
        as: "Ãnh sÃ¡ng Ä‘áº§y Ä‘á»§ ~12 giá»/ngÃ y, 10000â€“30000 lux",
        nd: "20â€“35Â°C",
        da: "80â€“90%",
        ph: "5.5â€“7.0",
        tuoi: "ThÆ°á»ng xuyÃªn giá»¯ áº©m",
        note: "Æ¯a nÆ°á»›c, thÃ­ch há»£p Ä‘áº¥t phÃ¹ sa."
      },
      {
        name: "CÃ  chua",
        latin: "Solanum lycopersicum",
        icon: "ğŸ…",
        as: "6~8 giá» sÃ¡ng/ngÃ y, 10000â€“20000 lux",
        nd: "22â€“28Â°C",
        da: "60â€“70%",
        ph: "6.0â€“6.8",
        tuoi: "Vá»«a pháº£i, trÃ¡nh Ãºng",
        note: "Cáº§n nhiá»u Ã¡nh sÃ¡ng vÃ  thoÃ¡ng khÃ­."
      },
      {
        name: "XÃ  lÃ¡ch",
        latin: "Lactuca sativa",
        icon: "ğŸ¥¬",
        as: "4~6 giá»/ngÃ y, 6000â€“8000 lux",
        nd: "15â€“25Â°C",
        da: "60â€“70%",
        ph: "6.0â€“6.8",
        tuoi: "Giá»¯ áº©m thÆ°á»ng xuyÃªn, trÃ¡nh khÃ´ háº¡n",
        note: "PhÃ¡t triá»ƒn tá»‘t á»Ÿ khÃ­ háº­u mÃ¡t."
      },
      {
        name: "á»št",
        latin: "Capsicum annuum",
        icon: "ğŸŒ¶ï¸",
        as: "Náº¯ng 6~8 giá»/ngÃ y, 6000â€“12000 lux",
        nd: "25â€“30Â°C",
        da: "60â€“70%",
        ph: "6.0â€“7.0",
        tuoi: "Äá»u Ä‘áº·n, trÃ¡nh Ãºng",
        note: "Æ¯a sÃ¡ng, cáº§n Ä‘áº¥t thoÃ¡t nÆ°á»›c tá»‘t."
      },
      {
        name: "DÆ°a leo",
        latin: "Cucumis sativus",
        icon: "ğŸ¥’",
        as: "Náº¯ng nháº¹ Ä‘áº¿n trung bÃ¬nh, 6000â€“12000 lux",
        nd: "20â€“30Â°C",
        da: "70â€“80%",
        ph: "5.5â€“7.0",
        tuoi: "Giá»¯ áº©m Ä‘áº¥t liÃªn tá»¥c",
        note: "Cáº§n nhiá»u nÆ°á»›c vÃ  giÃ¡ thá»ƒ thoÃ¡ng."
      },
      {
        name: "Hoa Há»“ng",
        latin: "Rosa spp.",
        icon: "ğŸŒ¹",
        as: "Ãnh sÃ¡ng máº¡nh 6~8h/ngÃ y, 10000â€“13500 lux",
        nd: "25â€“32Â°C",
        da: "50â€“70%",
        ph: "6.0â€“6.8",
        tuoi: "2â€“3 láº§n/tuáº§n",
        note: "Æ¯a náº¯ng, Ä‘áº¥t tÆ¡i xá»‘p."
      },
      {
        name: "CÃ¢y khÃ´ng khÃ­",
        latin: "Tillandsia spp.",
        icon: "ğŸŒ¿",
        as: "Ãnh sÃ¡ng tÃ¡n xáº¡ khÃ´ng náº¯ng gáº¯t, 1500â€“3000 lux",
        nd: "20â€“30Â°C",
        da: "50â€“70%",
        ph: "KhÃ´ng Ã¡p dá»¥ng (khÃ´ng Ä‘áº¥t)",
        tuoi: "Phun sÆ°Æ¡ng 1â€“2 láº§n/ngÃ y",
        note: "KhÃ´ng cáº§n Ä‘áº¥t, chá»‰ cáº§n Ä‘á»™ áº©m vÃ  lÆ°u thÃ´ng khÃ­."
      },
      {
        name: "Phong lan Dendrobium",
        latin: "Dendrobium spp.",
        icon: "ğŸŒ¸",
        as: "Ãnh sÃ¡ng giÃ¡n tiáº¿p, 10700â€“16000 lux",
        nd: "20â€“30Â°C",
        da: "60â€“80%",
        ph: "5.5â€“6.5",
        tuoi: "2â€“3 láº§n/tuáº§n",
        note: "Æ¯a áº©m, trÃ¡nh náº¯ng gáº¯t."
      },
      {
        name: "Phong lan Há»“ Äiá»‡p",
        latin: "Phalaenopsis spp.",
        icon: "ğŸ’®",
        as: "GiÃ¡n tiáº¿p, 5400â€“7290 lux",
        nd: "18â€“28Â°C",
        da: "60â€“80%",
        ph: "5.5â€“6.5",
        tuoi: "2â€“3 láº§n/tuáº§n, phun sÆ°Æ¡ng nháº¹",
        note: "Æ¯a áº©m, khÃ´ng chá»‹u náº¯ng trá»±c tiáº¿p."
      },
      {
        name: "DÆ°Æ¡ng xá»‰ tá»• chim",
        latin: "Asplenium nidus",
        icon: "ğŸŒ±",
        as: "Ãnh sÃ¡ng tÃ¡n xáº¡, trÃ¡nh náº¯ng gáº¯t",
        nd: "18â€“28Â°C",
        da: "60â€“80%",
        ph: "5.0â€“6.5",
        tuoi: "Giá»¯ áº©m Ä‘áº¥t, trÃ¡nh Ãºng",
        note: "Æ¯a mÃ¡t, trá»“ng nÆ¡i cÃ³ Ä‘á»™ áº©m cao."
      },
      {
        name: "Phong lan Cattleya",
        latin: "Cattleya spp.",
        icon: "ğŸŒ¼",
        as: "Ãnh sÃ¡ng giÃ¡n tiáº¿p, 16200â€“27000 lux",
        nd: "20â€“32Â°C",
        da: "60â€“80%",
        ph: "5.5â€“6.5",
        tuoi: "2 láº§n/tuáº§n, phun sÆ°Æ¡ng khi khÃ´",
        note: "Æ¯a sÃ¡ng nháº¹, cáº§n thÃ´ng thoÃ¡ng khÃ­."
      }
    ];

    const select = document.getElementById("plantSelect");
    const tableBody = document.getElementById("paramTable");
    const searchInput = document.getElementById("searchInput");

    
  // Helper function to normalize text by removing accents and converting to lowercase
  function normalizeText(text) {
    return text
      .toLowerCase()                               // Convert to lowercase
      .normalize("NFD")                             // Decompose characters with accents
      .replace(/[\u0300-\u036f]/g, "")              // Remove diacritics (accents)
      .replace(/\s+/g, "");                         // Remove spaces
  }

  // Function to filter plants based on the normalized search input
  function filterPlants(keyword) {
    const normalizedKeyword = normalizeText(keyword);

    // If the search term is empty or less than 2 characters, return all plants
    if (normalizedKeyword.length < 2) {
      loadPlantList(plants); // Show all plants if the search term is empty or too short
      return;
    }

    const filteredPlants = plants.filter(plant => 
      normalizeText(plant.name).includes(normalizedKeyword)  // Match the whole search string
    );

    // Load the filtered plants into the dropdown
    loadPlantList(filteredPlants); 
  }

  // Event listener for the search input field
  searchInput.addEventListener("input", e => {
    const keyword = e.target.value.trim();
    filterPlants(keyword); // Filter based on user input
  });

  // Function to display plants in the select dropdown
  function loadPlantList(list) {
    select.innerHTML = ""; // Clear the previous options

    // If no plants match, show a message in the dropdown
    if (list.length === 0) {
      const blankOption = document.createElement("option");
      blankOption.value = "";
      blankOption.textContent = "KhÃ´ng tÃ¬m tháº¥y cÃ¢y...";  // "No plants found"
      select.appendChild(blankOption);
    } else {
      // Populate the dropdown with filtered plants
      list.forEach((p, i) => {
        const opt = document.createElement("option");
        opt.value = i;
        opt.textContent = `${p.icon} ${p.name}`;  // Showing both icon and name
        select.appendChild(opt);
      });
    }
  }

  // Hiá»ƒn thá»‹ thÃ´ng tin cÃ¢y (Show plant information)
  function showPlant(i) {
    if (i === "" || i === undefined) return;  // If no plant is selected, do nothing

    const p = plants[i];
    document.getElementById("plantIcon").textContent = p.icon;
    document.getElementById("plantName").textContent = p.name;
    document.getElementById("plantLatin").innerHTML = `<em>${p.latin}</em>`;
    tableBody.innerHTML = ` 
      <tr><td>Ãnh sÃ¡ng</td><td>${p.as}</td></tr>
      <tr><td>Nhiá»‡t Ä‘á»™</td><td>${p.nd}</td></tr>
      <tr><td>Äá»™ áº©m Ä‘áº¥t</td><td>${p.da}</td></tr>
      <tr><td>pH</td><td>${p.ph}</td></tr>
      <tr><td>TÆ°á»›i</td><td>${p.tuoi}</td></tr>
    `;
    document.getElementById("note").textContent = p.note;
  }

  // Set up an event listener for when a user selects a plant from the dropdown
  select.addEventListener("change", e => {
    showPlant(e.target.value);  // Display selected plant's info
  });

  // Initialize with all plants (optional, but if you want it to show the full list initially)
  loadPlantList(plants);

  // Show info for the first plant by default (in case of initial page load)
  showPlant(0);

    

    // ğŸŒ¿ NÃºt Ã¡p dá»¥ng thÃ´ng sá»‘ â€” gá»­i sang ESP32 / IoT
  const BLYNK_API_URL = "https://cloud.blynk.cc/api/v1"; // Blynk Cloud API URL
  const BLYNK_AUTH_TOKEN = "QhaE1GqAW43iph5gu06laqEN7EcyEpFv"; // Your Blynk project Auth Token

  // Virtual pins on Blynk (v1, v2, v3, etc.)
  const VIRTUAL_PINS = {
    3: 'tempmin',    
    4: 'tempmax',        
    8: 'hummin',     
    9: 'hummax', 
    12: 'lightmin',   
    13: 'lightmax',  
  };

  // Handling the button click
  document.getElementById("applyBtn").addEventListener("click", async () => {
    const i = select.value; // Get selected plant index
    const data = plants[i];  // Get plant data

    try {
      // Send all data to Blynk at once
      await sendMultipleDataToBlynk(data);
      alert(`ğŸŒ¿ ÄÃ£ gá»­i thÃ´ng sá»‘ "${data.name}" Ä‘áº¿n Blynk!`);
    } catch (err) {
      alert("âš ï¸ Gá»­i tháº¥t báº¡i, kiá»ƒm tra máº¡ng hoáº·c thÃ´ng sá»‘!");
    }
  });

  // Function to send multiple data to Blynk at once
  async function sendMultipleDataToBlynk(data) {
    const parameters = {
      3: data.nd.split("â€“")[0].split('Â°')[0],         
      4: data.nd.split("â€“")[1].split('Â°')[0],      
      8: data.da.split("â€“")[0].split('%')[0],       
      9: data.da.split("â€“")[1].split('%')[0],         
      12: data.as.split("â€“")[0].split(' lux')[0],    
      13: data.as.split("â€“")[1].split(' lux')[0],       
    };

    // Loop through each virtual pin and send the corresponding data to Blynk
    for (const [pin, value] of Object.entries(parameters)) {
      try {
        const response = await fetch(`${BLYNK_API_URL}/${BLYNK_AUTH_TOKEN}/update/v${pin}?value=${encodeURIComponent(value)}`, {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          },
        });

        if (response.ok) {
          console.log(`v${pin} data sent to Blynk: ${value}`);
        } else {
          console.error(`Failed to send data to v${pin}`);
        }
      } catch (err) {
        console.error(`Error sending data to v${pin}:`, err);
      }
    }
  }
 </script>
</body>
</html>
